# 软件实现说明书

## 1. 前后端技术选型及理由

### 1.1 前端技术选型及理由

我们选择使用Vue3作为前端框架，主要有以下几个原因：

- Vue3是一种渐进式框架，可以逐步引入，并且与其他库或现有的项目进行整合。
- Vue3拥有简单易学的API和清新明了的文档，能够快速入门。
- Vue3是一种非常灵活的框架，可以轻松处理几乎所有的前端开发需求，具有非常广泛的用途。
- Vue3使用虚拟DOM和渲染优化等技术，能够最大程度的减少真实DOM操作的次数，从而大幅度提升渲染性能和用户体验。
- Vue3生态非常丰富，有众多优秀的第三方插件和库可供选择，能够轻松地完成各种开发需求和功能拓展。
- Vue3的组件化开发理念和良好的案例开源社区，使得前端开发人员能够快速的使用其他人开发的组件，让开发变得更加高效。

### 1.2 后端技术选型及理由

我们选择使用 Django 作为后端技术栈，主要有以下几个原因：

- Django是一个成熟而强大的Web应用程序框架，它提供了大量的内置功能和工具，能够快速构建高效且可扩展的应用程序。
- Django具有强大的ORM（对象关系映射）功能，可以方便地与数据库进行交互，提供了简洁的API来处理数据模型和查询。
- Django拥有丰富的生态系统和活跃的社区支持，有许多可用的第三方插件和库，可以快速实现各种功能需求。
- Django内置了一套完善的身份验证和权限管理系统，可以轻松实现用户认证和授权功能。

## 2. 软件实现的基本思路

### 2.1 需求分析
依据内容描述，确定火车购票系统的功能需求、性能需求、用户界面需求和安全需求等，同时对不同需求之间的优先级进行整理和排序。

### 2.2 架构设计
在需求分析的基础上，依据功能的差异，将火车购票系统分为用户管理模块、火车行程管理模块、购票管理模块、账户管理模块、联系人管理模块以及消息通知管理模块。每个模块包含一部分功能，在各模块之上，通过权限管理实现了不同用户角色的功能分离。六个模块组合在一起可以满足所有需求。

- 用户管理模块：提供普通用户的注册登录和系统管理员的管理等功能。
- 火车行程管理模块：提供火车行程的添加、修改、删除、查询等功能。
- 购票管理模块：提供用户的购票功能。
- 账户管理模块：提供用户账户的管理功能。
- 联系人管理模块：提供用户联系人信息的管理功能。
- 消息通知管理模块：提供网站消息通知的发送和接收等功能。

### 2.3 页面规划
将各个页面的功能分组，进行页面规划，设计不同的页面以满足其所在模块的需求。
- 注册页面：实现注册功能。用户输入自己的用户名、密码和邮箱进行注册。
- 主页面：实现注册登录和车次查询功能。用户可以注册旅客账号，登录自己的账号，还可以选择出发地、到达地和出发时间，查询满足条件的车次。
- 可选车次页面：实现车次选择、作为选择功能。从主页面跳转而来，列出查询到的满足条件的车次，供用户进行选择。用户可以自行选择该车次提供的不同类的的座位。
- 购票页面：实现购票功能。从可选车次页面跳转而来，显示用户选择的相应车票的信息和价格。用户可选择为其买票的联系人后确认购买，也可返回可选车次页面。
- 改签页面：实现改签功能。列出可改签的车次和座位类型，供用户选择。
- 订单管理页面：实现订单的支付、删除、退票和查看功能，列出订单，并允许用户进行支付、删除、退票、查看详情操作。
- 账户管理页面：实现充值和账户添加功能。列出用户名下的账户，并允许用户选择充值和添加账户。
- 联系人管理页面：实现添加联系人和删除联系人功能。列出用户保存的联系人，并允许用户增删联系人。
- 通知公告页面：实现站内信功能，用户可以查看车次动态。
- 订单支付页面：实现支付订单功能，由订单管理页面跳转而来，显示待支付订单的信息，需要用户选择账户来支付。
- 列车时刻表页面：实现列出现在所有的车次的功能，并且在该页面上可以删除和调整车次的功能，铁路系统员可以在该页面查看当前所有车次，并且选择车次对其进行删除和调整操作。
- 添加站点页面：页面的左边实现列出站点的功能，页面的右边实现添加站点的功能。铁路系统员可以在该页面查看当前所有站点，并进行添加操作。
- 添加车厢页面：页面的左边实现列出车厢的功能，页面的右边实现添加车厢的功能。铁路系统员可以在该页面查看当前所有车厢，并进行添加操作。
- 添加车次页面：页面实现添加车次的功能，铁路系统员根据步骤条的提醒一步一步分别输入车次编号、站点、车厢以及出发到达时间。
- 调整车次页面：页面实现调整车次的功能，从列车时刻表页面跳转而来，在该页面上，铁路系统员根据步骤条的提示一步步输入站点、车厢等信息来调整车次。
- 新增用户页面：页面实现新增用户的功能，系统管理员通过输入用户名、密码、邮箱等信息来新增用户，并且系统管理员可以在这个页面为新增用户赋予身份。
- 用户管理页面：页面实现列出用户并且对用户进行更改和注销功能。系统管理员可以在该页面看到当前所有的用户，并且点击按钮来实现更改和注销功能。

### 2.4 页面设计
依据各个页面不同的需求，对页面的大致布局和使用到的组件进行基本的构思。
- 用户端页面的整体背景、所有页面的导航栏样式与上下边框的设置应相同，并应有系统名称“畅游中国”，且应能表示本系统为火车购票系统。导航栏的内容根据所在模块需求的不同应有些许变化。
- 登录页面应能满足普通用户、铁路系统员、系统管理员三个身份的用户的登录需求。由于大多使用者为普通用户，登录页面应默认为普通用户的登录页面，并提供切换至铁路系统员和系统管理员的按钮。当用户没有注册时，应有相应的按钮允许用户跳转至注册页面。
- 注册页面除了用户名、输入密码、确认密码、输入邮箱外，还应有能返回登录页面的按钮。
- 主页面查询车次时，出发地与到达地的选择范围都是有限的，故使用下拉选择框，规定用户的可选择范围。日期的选择也是有限的，故使用日期选择器组件，省去了判断用户输入日期是否合法的步骤。
- 用户使用的页面的大致布局基本相同，均为上方标题、下方内容的样式。由于用户使用的页面经常需要显示拥有许多属性的大量条目供用户选择，在设计页面时选择了表格组件来展示这些内容。
- 在实现列出功能的页面几乎都采用了滚动条的形式，使得用户以及管理员在使用列出功能时，可以滚动查看。
- 在每个页面下方都列出了畅游中国的底边栏，使得整个页面看上去更具有整体性。

### 2.5 接口设计
依据不同模块、不同页面的功能，为其提供相应的接口，以满足需求。
#### 2.5.1 用户管理
- 列出所有用户：使用GET方法，后端返回所有用户的基础信息，包括用户id、用户名、密码、邮箱和身份。
- 增加用户：使用POST方法，前端向后端传递所需添加的用户的基础信息，后端将其加入到数据库中。
- 删除用户：使用DELETE方法，前端向后端传递所需删除的用户的id，后端将该id对应的用户从数据库中删除。
- 修改用户：使用PUT方法，前端向后端传递所需修改的用户的id以及其他修改后的基础信息，后端将该id对应的用户的信息进行相应的修改。
- 普通用户注册：使用POST方法，前端向后端传递新注册用户的用户名、密码和邮箱，后端将其加入到数据库中，并为其分配一个新的用户id。
- 普通用户注册验证：使用GET方法，前端向后端传递一串加密了的验证信息，后端将其发送至用户邮箱。
- 普通用户登录：使用POST方法，前端向后端传递用户输入的密码，后端在数据库中比对密码，并返回是否匹配的结果。若匹配，则还需要返回jwt。
#### 2.5.2 账户管理
- 列出账户：使用GET方法，后端返回当前登录用户的所有账户的基础信息，包括账户id、账户名称、卡号和余额。
- 添加账户：使用POST方法，前端向后端传递所需添加的账户的基础信息，后端将其加入到数据库中，并为其分配一个id。
- 删除账户：使用DELETE方法，前端向后端传递所需删除的账户的id，后端将该id对应的登录用户的账户删除。
- 账户充值：使用PUT方法，前端向后端传递账户id和充值金额，后端将金额加入到登录用户的该账户中。
#### 2.5.3 火车行程管理
- 列出行程：使用GET方法，后端返回所有车次信息，包括车次id、车次编号、出发时间、途径站点和车厢。
- 列出可作为改签目标的行程：使用GET方法，前端向后端传递要被改签的车次的id，后端经过计算找到可作为改签目标的车次，并返回它们的基础信息。
- 列出特定行程信息：使用GET方法，前端向后端传递查询的车次的id，后端找到该车次并返回其信息。
- 列出站点：使用GET方法，后端返回所有站点的基础信息，包括站点id、站点编号和站点名。
- 列出车厢：使用GET方法，后端返回所有车厢的基础信息，包括车厢id、车厢名和车厢内的最大座位数量。
- 添加站点：使用POST方法，前端向后端传递所要添加的站点的编号和名称，后端将其添加到数据库中，并为其分配一个id。
- 添加车厢：使用POST方法，前端向后端传递所要添加的车厢的名称、最大座位数和座位加席率，后端将其添加到数据库中，并为其分配一个id。
- 添加行程：使用POST方法，前端向后端传递所需添加的车次的基础信息，后端将其加入到数据库中，并为其分配一个id。
- 修改行程：使用PUT方法，前端向后端传递所需修改的车次的id以及其他修改后的基础信息，后端将该id对应的车次的信息进行相应的修改。
- 删除行程：使用DELETE方法，前端向后端传递所需删除的车次的id，后端将该id对应的车次从数据库中删除。
#### 2.5.4 联系人管理
- 列出联系人：使用GET方法，后端返回当前登录用户所有联系人的信息，包括联系人id、姓名、性别、出生日期和卡号。
- 添加联系人：使用POST方法，前端向后端传递所需添加的联系人的基础信息，后端将其加入到数据库中，并为其分配一个id。
- 删除联系人：使用DELETE方法，前端向后端传递所需删除的联系人的id，后端将该id对应的车次从数据库中删除。
#### 2.5.5 购票管理
- 列出车票：使用GET方法，后端返回当前登录用户所有车票的信息，包括车票id、是否有效、对应车次、车厢、联系人、票价、下单时间、是否支付、车次是否修改和座位号。
- 删除车票：使用DELETE方法，前端向后端传递需要取消的车票id，后端应检查该id对应的车票是否已支付，若未支付则从数据库中删除。
- 取消已购车票：使用DELETE方法，前端向后端传递需要退掉的车票id和用户选择的退款的账户id，后端应检查该id对应的车票是否已支付，若已支付则检查当前时间是否是车票车次出发时间的一小时内，若是则退票失败，若不是则将车票从数据库中删除并将票价所示金额添加到前端传递的账户id对应的当前登录用户的账户的余额上。
- 车票改签：使用PUT方法，前端向后端传递所需修改的车票的id、要改签的车次的id以及车厢的id，后端将该id对应的车票的信息进行相应的修改。
- 购买车票：使用POST方法，前端向后端传递所需添加的车票的基础信息，后端初始化其是否有效、是否已支付以及车次是否修改的状态，并将其加入到数据库中，并为其分配一个id。
- 支付车票：使用PATCH方法，前端向后端传递所需支付的车票的id和用户选择的付款的账户id，后端应修改该车票id对应的车票的支付状态，并扣除账户id对应的登录用户的账户余额。
#### 2.5.6 消息管理
- 列出已收消息：使用GET方法，前端向后端传递非发送消息的标志，后端返回已收到的消息的基本信息，包括信息id、发送者id、消息内容以及发送时间。
### 2.6 页面美化
- 选择合适的背景图片，并调节透明度，使得背景图片既不喧宾夺主，又能起到美化效果。
- 统一各页面的细节，如颜色、标题位置、按钮宽度等。
- 美化主页面。主页面作为首先出现的页面，应足够美观。为此，添加走马灯组件制作滚动的图片，并添加新闻。
- 将登录页面简化为弹窗，并加入图片。登录方式改为点击页面右上角登录文字。该文字可切换登录与未登录状态。
- 使用Element Plus组件库来加强页面的美观性和统一性。
- 为了能够使铁路系统员清晰地了解到整个添加车次的流程，在车次添加页面添加了一个步骤条组件框，使得铁路系统员能够知道自己此刻处于哪一步骤并继续进行之后的步骤。

### 2.7 测试与总结
- 前端测试

    主要工作是设计一些测试用例。以注册为例，要求密码长度在2到10之间，则可以设计一个黑盒测试，确保不会有错误的密码被注册。而对于购票流程，则可以设计白盒测试，模拟成功支付，取消支付，支付但申请退款等等流程，确保每种流程都能正常执行。在测试过程中，互相测试对方的页面并进行修改。
- 前端总结

    在测试过程中，发现在编写页面期间还存在许多逻辑不缜密导致用户体验不好的问题以及前后端接口连接不够严密等问题，导致在测试过程中需要边进行测试边进行修改代码。同时在测试的过程中，也发现了前端人员交流不够多，导致对彼此的页面不够熟悉，分工不够明确，有很多功能被实现多次或者没人实现。前后端人员交流也不够深入，一般都只是彼此询问对方能否实现某个功能，而不完全了解一个模块的整个功能，在今后的开发过程中需要多多注意。

- 后端测试
  - 使用unitest进行单元测试，针对每个接口api进行覆盖测试，确保后端设计、实现正确无误。视接口码量在一个测试类内部测试一至三个接口，保证代码可读性和封装。
  - 使用web端postman进行黑盒测试，事实上分别按照后端代码文件结构和系统工作时序进行了两轮测试，强调频繁承担系统功能的部分接口的正确性。

- 后端总结
  后端实现上十分依靠需求，开发进行到中后期时发现需求有纰漏是对后端的破坏非常严重。不过相较于前端，后端的编码更接近于以往的练习，因而比较轻松地就通过了测试。作为需求的最终实现逻辑，后端与需求的绑定十分紧密。本次开发就遇到了修改需求的问题，做了很多无用功。


## 3. 软件实现的设计模型

为了提高软件的鲁棒性和可维护性，我们采用了MVC设计模式，将业务逻辑和数据层进行分离，同时将视图展示和用户交互进行分离，具体如下：

- 数据层采用ORM进行操作，实现数据存储和持久化。
- 业务逻辑层采用 Django REST framework 进行实现，包括接口访问和数据处理。
- 视图展示和用户交互采用Vue3框架实现，主要包括页面渲染和交互事件处理。

## 4. 前后端代码映射方法介绍

### 4.1 前后端代码映射介绍

为了实现前后端的良好协作和代码复用，我们采用如下映射方式：

- 前端Vue3组件对应后端API接口。
- 前端组件的属性和状态对应后端API接口的参数和返回值。
- 前端组件的事件和数据处理逻辑对应后端API接口的业务逻辑实现。

### 4.2 映射设计模型及实现流程

映射实现流程如下：

1. 前端组件发出请求，调用后端API接口。
2. 后端API接口接收并处理请求数据，并返回相应结果。
3. 前端组件接收并处理后端API返回结果，并更新视图状态。

## 5. 总结

通过本次的软件实现，我们对前后端技术选型、设计模式和代码开发等方面进行了深刻的思考和实践。在开发过程中，我们遇到了一些问题，如组件库的使用、页面布局设计等，但通过不断的学习和探索，成功地解决了这些问题，同时也提高了我们的技术水平和团队协作能力。
